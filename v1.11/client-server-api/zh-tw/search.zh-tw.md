### 伺服器端搜索

搜索API允許用戶端在用戶所在的所有聊天室（包括已離開的聊天室）中的事件進行全文搜索。只有用戶被允許看到的事件才會被搜索，例如，它不會包括你離開後在聊天室中發生的事件。

#### 用戶端行為

有一個單一的HTTP API用於執行伺服器端搜索，文檔如下。

{{% http-api spec="client-server" api="search" %}}

#### 搜索類別

搜索API允許用戶端在不同類別的項目中搜索。目前唯一指定的類別是`room_events`。

##### `room_events`

此類別涵蓋用戶被允許看到的所有事件，包括他們已離開的聊天室中的事件。搜索在某些事件類型的某些鍵上執行。

支持搜索的鍵有：

- `m.room.message`中的`content.body`
- `m.room.name`中的`content.name`
- `m.room.topic`中的`content.topic`

搜索將*不*包括端到端加密的聊天室。

結果包括一個`rank`鍵，可用於按相關性對結果進行排序。`rank`越高，結果越相關。

`count`的值給出了結果總數的近似值。家園伺服器可能給出此字段的估計值而不是確切值。

#### 排序

用戶端可以指定伺服器返回結果的排序方式。允許的兩種排序方式是：

- `rank`，返回最相關的結果優先。
- `recent`，返回最近的結果優先。

默認排序是`rank`。

#### 分組

用戶端可以請求結果與分組資訊一起返回，例如按`room_id`分組。在這種情況下，回應將包含每個不同`room_id`值的組條目。每個組條目至少包含該組中的`event_ids`列表，以及可能的其他關於該組的元數據。

當前要求支持的分組有：

- `room_id`
- `sender`

#### 分頁

伺服器可能在回應的各個地方返回`next_batch`鍵。這些用於對結果進行分頁。要獲取更多結果，用戶端應該向伺服器發送*相同*的請求，並設置`next_batch`查詢參數為該令牌。

分頁的範圍根據`next_batch`令牌返回的位置而定義。例如，使用組內的令牌將返回該組內的更多結果。

目前支持的`next_batch`令牌位置是：

- `search_categories.<category>.next_batch`
- `search_categories.<category>.groups.<group_key>.<group_id>.next_batch`

即使有更多匹配的結果，伺服器也不需要支持分頁。在這種情況下，它們不能在回應中返回`next_batch`令牌。

#### 安全考慮

伺服器必須只返回用戶有權限看到的結果。
