### 伺服器通知

家園伺服器主機經常需要以官方身份向用戶發送訊息,或者有影響用戶使用家園伺服器能力的資源限制。例如,家園伺服器可能限制每月活躍用戶數量,並且已經超過了這個限制。為了向用戶傳達這種故障,家園伺服器會使用伺服器通知聊天室。

聊天室的美化(名稱、主題、頭像等)作為實現細節留給具體實現。建議家園伺服器裝飾聊天室,使其看起來像是用戶的官方聊天室。

#### 事件

通知以普通的`m.room.message`事件的形式發送給用戶端,在伺服器通知聊天室中`msgtype`為`m.server_notice`。用戶端必須忽略伺服器通知聊天室之外的`m.server_notice` `msgtype`事件。

`server_notice_type`的指定值為:

`m.server_notice.usage_limit_reached`
伺服器已超過某些需要伺服器管理員介入的限制。`limit_type`描述了達到的限制類型。`limit_type`的指定值為:

`monthly_active_user`
伺服器在過去30天內的活躍用戶數已超過最大值。伺服器正在拒絕新的連接。"活躍"的定義留作實現細節,但鼓勵伺服器將同步的用戶視為"活躍"。

{{% event event="m.room.message$m.server_notice" title="`m.room.message` with `msgtype: m.server_notice`" %}}

#### 用戶端行為

用戶端可以通過聊天室上的`m.server_notice`標籤來識別伺服器通知聊天室。活躍的通知由伺服器通知聊天室中的[置頂事件](#mroompinned_events)表示。在該聊天室中置頂的伺服器通知事件應該通過特殊的UI顯示給用戶,而不是通過用戶端中的正常置頂事件介面顯示。例如,用戶端可能會顯示警告橫幅或彈出對話框以引起用戶的注意。在伺服器通知聊天室中置頂的非伺服器通知事件應該像任何其他聊天室中的置頂事件一樣顯示。

用戶端不能期望能夠拒絕加入伺服器通知聊天室的邀請。嘗試拒絕邀請必須導致`M_CANNOT_LEAVE_SERVER_NOTICE_ROOM`錯誤。伺服器不應阻止用戶在加入伺服器通知聊天室後離開聊天室,但如果伺服器要阻止離開聊天室,必須使用相同的錯誤代碼。

#### 伺服器行為

伺服器應該為每個用戶管理恰好1個伺服器通知聊天室。伺服器必須使用`m.server_notice`標籤向用戶端標識此聊天室。伺服器應該邀請目標用戶,而不是自動將他們加入伺服器通知聊天室。

伺服器如何向用戶端發送通知,以及它們使用哪個用戶發送事件,作為伺服器的實現細節留給具體實現。
